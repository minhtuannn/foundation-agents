In [1]:
import warnings
warnings.filterwarnings('ignore')

import pandas as pd
import numpy as np
from sklearn.model_selection import RepeatedStratifiedKFold
from sklearn.preprocessing import LabelEncoder, OrdinalEncoder
from sklearn.metrics import accuracy_score, log_loss
import xgboost as xgb
Based on @canozensoy's https://www.kaggle.com/code/canozensoy/ps-s5e7-personality-classification-with-xgboost
Adding a feature where there is a match to the original data.
In [2]:
df_orig = (
    pd.read_csv('/kaggle/input/extrovert-vs-introvert-behavior-data-backup/personality_datasert.csv')
    .rename(columns={
        'Personality': 'match_p'
    })
    .drop_duplicates(['Time_spent_Alone', 'Stage_fear', 'Social_event_attendance',
       'Going_outside', 'Drained_after_socializing', 'Friends_circle_size',
       'Post_frequency']))
In [3]:
train = pd.read_csv("/kaggle/input/playground-series-s5e7/train.csv")
test = pd.read_csv("/kaggle/input/playground-series-s5e7/test.csv")
submission = pd.read_csv("/kaggle/input/playground-series-s5e7/sample_submission.csv")
In [4]:
train = train.merge(df_orig, how='left')
test = test.merge(df_orig, how='left')
In [5]:
le = LabelEncoder()
train["Personality_encoded"] = le.fit_transform(train["Personality"])
In [6]:
X = train.drop(columns=["id", "Personality", "Personality_encoded"])
y = train["Personality_encoded"]
X_test = test.drop(columns=["id"])
In [7]:
combined = pd.concat([X, X_test], axis=0)
cat_cols = combined.select_dtypes(include="object").columns.tolist()
encoder = OrdinalEncoder()
combined[cat_cols] = encoder.fit_transform(combined[cat_cols])

X = combined.iloc[:len(X)].reset_index(drop=True)
X_test = combined.iloc[len(X):].reset_index(drop=True)
In [8]:
params = {
    "objective": "binary:logistic",
    "eval_metric": "logloss",
    "max_depth": 4,
    "eta": 0.01,
    "subsample": 0.8,
    "colsample_bytree": 0.8,
    "random_state": 42
}
In [9]:
N_SPLITS = 5
N_REPEATS = 1
skf = RepeatedStratifiedKFold(
    n_splits=N_SPLITS, n_repeats=N_REPEATS, random_state=42)
oof_preds = np.zeros(len(X))
test_preds = np.zeros(len(X_test))

for fold, (train_idx, val_idx) in enumerate(skf.split(X, y)):
    X_train, X_val = X.iloc[train_idx], X.iloc[val_idx]
    y_train, y_val = y.iloc[train_idx], y.iloc[val_idx]
    
    dtrain = xgb.DMatrix(X_train, label=y_train)
    dval = xgb.DMatrix(X_val, label=y_val)
    dtest = xgb.DMatrix(X_test)

    model = xgb.train(params, dtrain, num_boost_round=1000,
                      evals=[(dval, "valid")],
                      early_stopping_rounds=50, verbose_eval=False)
    
    oof_preds[val_idx] += model.predict(dval) / N_REPEATS
    test_preds += model.predict(dtest) / (N_REPEATS * N_SPLITS)
In [10]:
model.get_score(importance_type='gain')
Out[10]:
{'Time_spent_Alone': 41.13698196411133,
 'Stage_fear': 223.28128051757812,
 'Social_event_attendance': 14.685726165771484,
 'Going_outside': 6.223846435546875,
 'Drained_after_socializing': 1046.4510498046875,
 'Friends_circle_size': 3.126570701599121,
 'Post_frequency': 4.398182392120361,
 'match_p': 6.6707634925842285}
In [11]:
ll = log_loss(y, oof_preds)
cv_acc = accuracy_score(y, oof_preds > 0.5)
print(f"Cross-Validation log loss:{ll:.4f}, accuracy:{cv_acc:.4f}")

# Create submission
final_preds = (test_preds > 0.5).astype(int)
submission["Personality"] = le.inverse_transform(final_preds)
submission.to_csv("submission.csv", index=False)
submission.head()
Cross-Validation log loss:0.1246, accuracy:0.9702
Out[11]:
id Personality
0 18524 Extrovert
1 18525 Introvert
2 18526 Extrovert
3 18527 Extrovert
4 18528 Introvert
Compare to public notebooks
unfold_moreShow hidden code
In [13]:
# The tiny differences...
(df1.merge(df2, on='id').merge(df3, on='id')
    .query('Personality_x != Personality_y or Personality_x != Personality'))
Out[13]:
id Personality_x Personality_y Personality
611 19135 Extrovert Introvert Introvert
1007 19531 Extrovert Introvert Introvert
1088 19612 Extrovert Extrovert Introvert
1493 20017 Extrovert Introvert Introvert
2135 20659 Extrovert Introvert Introvert
2410 20934 Extrovert Extrovert Introvert
2742 21266 Extrovert Introvert Introvert
2835 21359 Extrovert Extrovert Introvert
3396 21920 Extrovert Introvert Introvert
3957 22481 Extrovert Introvert Introvert
5131 23655 Extrovert Introvert Introvert